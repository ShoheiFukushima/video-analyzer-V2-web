displayName: "Cloud Run - High Latency (p95)"
documentation:
  content: |
    ## レスポンスタイム高騰アラート

    **症状**: p95レスポンスタイムが60秒を超えています

    **影響**: ユーザー体験の悪化、タイムアウトの可能性

    **対応手順**:
    1. Cloud Trace で遅いリクエストを特定
    2. CPU/メモリ使用率を確認
    3. 同時実行数を確認し、必要であればスケーリング調整
    4. FFmpeg処理やAI API呼び出しのパフォーマンスを確認
  mimeType: text/markdown
conditions:
  - displayName: "p95 latency > 60s"
    conditionThreshold:
      aggregations:
        - alignmentPeriod: 300s
          perSeriesAligner: ALIGN_DELTA
          crossSeriesReducer: REDUCE_PERCENTILE_95
          groupByFields:
            - resource.service_name
      comparison: COMPARISON_GT
      duration: 300s
      filter: |
        resource.type = "cloud_run_revision"
        AND resource.labels.service_name = "video-analyzer-worker"
        AND metric.type = "run.googleapis.com/request_latencies"
      thresholdValue: 60000
combiner: OR
enabled: true
