# Video Analyzer V2 Web - Claudeé–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.2.0
**æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ5æ—¥
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœ¬ç•ªé‹ç”¨ä¸­

---

## âš ï¸ é‡è¦ï¼šã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯Cloudflare R2

**Vercel Blobã¯ä½¿ç”¨ã—ãªã„**ã€‚2GBå‹•ç”»å¯¾å¿œã®ãŸã‚**Cloudflare R2**ã«ç§»è¡Œæ¸ˆã¿ã€‚
- ã‚³ãƒ¼ãƒ‰å†…ã®`@vercel/blob`å‚ç…§ã¯æ—§ä»•æ§˜ï¼ˆæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è¡¨ã¯æ›´æ–°äºˆå®šï¼‰
- æ–°è¦å®Ÿè£…ã¯å¿…ãšR2ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆ`src/lib/r2.ts`ç­‰ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨

---

## ðŸ“Œ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ç›®çš„
å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€AIï¼ˆOpenAI Whisper + Google Gemini Visionï¼‰ã‚’ä½¿ç”¨ã—ã¦éŸ³å£°æ–‡å­—èµ·ã“ã—ã¨OCRã‚’å®Ÿè¡Œã—ã€ã‚·ãƒ¼ãƒ³å˜ä½ã§ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ†ã‚­ã‚¹ãƒˆã‚’çµ±åˆã—ãŸExcelãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
- å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œè€…
- ãƒ¡ãƒ‡ã‚£ã‚¢åˆ†æžè€…
- å­—å¹•ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆè€…
- ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒªã‚µãƒ¼ãƒãƒ£ãƒ¼

### ä¸»è¦æ©Ÿèƒ½ï¼ˆV2.1.0æ™‚ç‚¹ï¼‰
- **Whisper AIéŸ³å£°æ–‡å­—èµ·ã“ã—**: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãé«˜ç²¾åº¦ãƒ†ã‚­ã‚¹ãƒˆåŒ–ï¼ˆVADæœ€é©åŒ–ã§40-60%ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
- **Gemini Vision OCR**: å‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã®ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆæ—¥æœ¬èªžãƒ»è‹±èªžå¯¾å¿œï¼‰
- **ã‚·ãƒ¼ãƒ³æ¤œå‡º**: ãƒžãƒ«ãƒãƒ‘ã‚¹FFmpegã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆé–¾å€¤: 0.025, 0.055, 0.085ï¼‰
- **ROIï¼ˆRegion of Interestï¼‰æ¤œå‡º** (2025-11-14è¿½åŠ ): ãƒ†ãƒ­ãƒƒãƒ—ãƒ»å­—å¹•å¤‰åŒ–ã®æ¤œå‡ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã€ä¸‹æ®µ15%é ˜åŸŸå¯¾å¿œï¼‰
- **ç†æƒ³çš„Excelãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆï¼ˆV2.1ï¼‰**: 5åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆScene #, Timecode, Screenshot, OCR Text, NA Textï¼‰
- **è‡ªå‹•Blobã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: å®¹é‡åˆ¶é™å¯¾ç­–ï¼ˆã‚½ãƒ¼ã‚¹å‹•ç”»ãƒ»çµæžœã®è‡ªå‹•å‰Šé™¤ï¼‰
- **Clerkèªè¨¼**: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
- **RLSï¼ˆRow Level Securityï¼‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### å¯¾å¿œå‹•ç”»å½¢å¼
- MP4, MOV, AVI, MKV, WebM
- ç¸¦ãƒ»æ¨ªå‘ãå¯¾å¿œï¼ˆã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³å‹•ç”»å«ã‚€ï¼‰
- æœ€å¤§4Kè§£åƒåº¦
- æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 500MB
- ã‚¹ãƒ†ãƒ¬ã‚ª/ãƒ¢ãƒŽãƒ©ãƒ«éŸ³å£°
- éŸ³å£°ãªã—å‹•ç”»ï¼ˆOCRã®ã¿ï¼‰

---

## ðŸ—ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆV2.1.0ï¼‰

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVercelï¼‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **Next.js** | 14.2.0 | Reactãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆApp Routerï¼‰ |
| **React** | 18.3.0 | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| **TypeScript** | 5.5.0 | åž‹å®‰å…¨æ€§ |
| **Tailwind CSS** | 3.4.0 | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| **Clerk** | 5.0.0 | èªè¨¼ |
| **@vercel/blob** | 0.23.0 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| **@tanstack/react-query** | 5.0.0 | ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚° |
| **axios** | 1.7.0 | HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |
| **lucide-react** | 0.400.0 | ã‚¢ã‚¤ã‚³ãƒ³ |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆGoogle Cloud Runï¼‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **Node.js** | 20.x (æœ¬ç•ª) / 24.10.0 (ãƒ­ãƒ¼ã‚«ãƒ«) | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  |
| **Express.js** | 4.x | APIã‚µãƒ¼ãƒãƒ¼ |
| **TypeScript** | 5.3.3 | åž‹å®‰å…¨æ€§ |
| **FFmpeg** | 7.1 (Static) | å‹•ç”»ãƒ»éŸ³å£°å‡¦ç† |
| **OpenAI Whisper API** | whisper-1 | éŸ³å£°æ–‡å­—èµ·ã“ã— |
| **Google Gemini Vision** | gemini-2.5-flash | OCR |
| **ExcelJS** | 4.4.0 | Excelãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ |
| **@supabase/supabase-js** | 2.38.0 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |
| **silero-vad-node** | æœ€æ–° | éŸ³å£°æ´»å‹•æ¤œå‡ºï¼ˆVADï¼‰ |
| **@vercel/blob** | 2.0.0 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |

### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | ç”¨é€” | ãƒªãƒ¼ã‚¸ãƒ§ãƒ³/ãƒ—ãƒ©ãƒ³ |
|---------|------------|------|----------------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | Vercel | Next.jsã‚¢ãƒ—ãƒªé…ä¿¡ãƒ»CDN | Autoï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«CDNï¼‰ |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ | Google Cloud Run | Dockerã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œ | ãƒžãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ6ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | Cloudflare R2 | å‹•ç”»ãƒ»Excelä¸€æ™‚ä¿å­˜ | Free Tier |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Supabase | PostgreSQLï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼‰ | Free Tier |
| èªè¨¼ | Clerk | ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† | Development |
| DNS | ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ | ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç† | - |

### ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»DNSè¨­å®šï¼ˆ2026å¹´2æœˆ11æ—¥è¿½åŠ ï¼‰

| é …ç›® | å€¤ |
|------|-----|
| **æœ¬ç•ªãƒ‰ãƒ¡ã‚¤ãƒ³** | `https://video.function-eight.com/` |
| **è¦ªãƒ‰ãƒ¡ã‚¤ãƒ³** | `function-eight.com` |
| **DNSç®¡ç†** | ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ |
| **SSL** | Vercelè‡ªå‹•ç™ºè¡Œ |

### Cloud Run ãƒžãƒ«ãƒãƒªãƒ¼ã‚¸ãƒ§ãƒ³æ§‹æˆï¼ˆ2026å¹´2æœˆ11æ—¥è¿½åŠ ï¼‰

**ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ6ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰**:
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | å ´æ‰€ | ä¸»ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ |
|-----------|------|-------------|
| `asia-northeast1` | æ±äº¬ | æ—¥æœ¬ |
| `asia-southeast1` | ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ« | æ±å—ã‚¢ã‚¸ã‚¢ |
| `australia-southeast1` | ã‚·ãƒ‰ãƒ‹ãƒ¼ | ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ |
| `europe-west1` | ãƒ™ãƒ«ã‚®ãƒ¼ | ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ |
| `southamerica-east1` | ã‚µãƒ³ãƒ‘ã‚¦ãƒ­ | å—ç±³ |
| `us-central1` | ã‚¢ã‚¤ã‚ªãƒ¯ | åŒ—ç±³ |

**é‡è¦**: ã‚³ãƒ¼ãƒ‰å¤‰æ›´æ™‚ã¯**å…¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ‡ãƒ—ãƒ­ã‚¤**ãŒå¿…è¦ï¼ˆArtifact RegistryçµŒç”±ã§åŒä¸€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å±•é–‹ï¼‰ã€‚

### Cloud Run ãƒªã‚½ãƒ¼ã‚¹è¨­å®šï¼ˆ2026å¹´2æœˆ5æ—¥æ›´æ–°ï¼‰
| é …ç›® | å€¤ | èª¬æ˜Ž |
|-----|-----|------|
| **CPU** | 4 vCPU | FFmpegå‡¦ç†ã«æœ€é©åŒ– |
| **ãƒ¡ãƒ¢ãƒª** | 4 GB | CPU ã«åˆã‚ã›ã¦å¢—åŠ  |
| **åŒæ™‚å®Ÿè¡Œæ•°** | 1 | å‹•ç”»å‡¦ç†ã¯1ãƒªã‚¯ã‚¨ã‚¹ãƒˆãšã¤ |
| **CPUã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°** | ç„¡åŠ¹ | å¸¸æ™‚CPUã‚’å‰²ã‚Šå½“ã¦ |
| **å®Ÿè¡Œç’°å¢ƒ** | gen2 | Linux VMï¼ˆgVisorã§ã¯ãªã„ï¼‰ |
| **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ** | 600ç§’ | 10åˆ† |
| **æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹** | 10 | ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ä¸Šé™ |

**é‡è¦**: gen2å®Ÿè¡Œç’°å¢ƒã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€FFmpeg/ffprobeã®ãƒãƒ³ã‚°å•é¡Œã‚’å›žé¿ã€‚

---

## ðŸŽ¯ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è¦ç‚¹

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼]
    â†“ HTTPS
[Next.js Frontend (Vercel)]
    â†“ Clerkèªè¨¼
[API Routes]
    â†“ WORKER_SECRETèªè¨¼
[Cloud Run Worker (GCP)]
    â†“ Service Role Key
[Supabase Database] + [Vercel Blob Storage]
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ï¼ˆç°¡æ˜“ç‰ˆï¼‰
1. **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ Vercel Blob â†’ å‡¦ç†é–‹å§‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
2. **å‡¦ç†**: Cloud Run Worker â†’ å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â†’ FFmpeg â†’ Whisper/Gemini â†’ Excelç”Ÿæˆ
3. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ã‚½ãƒ¼ã‚¹å‹•ç”»å‰Šé™¤ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç›´å¾Œï¼‰
4. **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ Supabaseï¼ˆBlob URLå–å¾—ï¼‰ â†’ Vercel Blob â†’ Excelå‰Šé™¤ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç›´å¾Œï¼‰

### å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
1. **å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰** (0-10%)
2. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º** (10-20%)
3. **éŸ³å£°æ¤œå‡º** (20-30%)
4. **VAD + Whisperå‡¦ç†** (30-50%)
5. **ã‚·ãƒ¼ãƒ³æ¤œå‡º + OCR + Excelç”Ÿæˆ** (50-90%)
6. **çµæžœã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** (90-100%)

---

## âš ï¸ é–‹ç™ºæ™‚ã®é‡è¦ãªæ³¨æ„äº‹é …

### ðŸš« çµ¶å¯¾ã«è§¦ã‚‰ãªã„ã‚‚ã®

#### 1. æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹èªè¨¼è¨­å®š
- **Clerkè¨­å®š**: èªè¨¼ãƒ•ãƒ­ãƒ¼ãŒç¢ºç«‹æ¸ˆã¿
- **WORKER_SECRET**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ â‡” Cloud Run Workeré–“ã®èªè¨¼ã‚­ãƒ¼
- **Supabase RLS**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆIDORä¿®æ­£æ¸ˆã¿ï¼‰

#### 2. Vercel Blobè‡ªå‹•å‰Šé™¤æ©Ÿèƒ½
**å ´æ‰€**:
- `cloud-run-worker/src/services/videoProcessor.ts:videoProcessor.ts:212-217` (ã‚½ãƒ¼ã‚¹å‹•ç”»å‰Šé™¤)
- `app/api/download/[uploadId]/route.ts:route.ts:56-66` (Excelå‰Šé™¤)

**ç†ç”±**: Vercel Blob Hobby ãƒ—ãƒ©ãƒ³ã®1GBåˆ¶é™å¯¾ç­–ã¨ã—ã¦å®Ÿè£…æ¸ˆã¿ã€‚å‰Šé™¤ã™ã‚‹ã¨å®¹é‡è¶…éŽã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚

#### 3. VADï¼ˆéŸ³å£°æ´»å‹•æ¤œå‡ºï¼‰ã®è¨­å®š
**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `maxChunkDuration`: 10ç§’ï¼ˆWhisperæœ€é©åŒ–ï¼‰
- `minSpeechDuration`: 0.25ç§’
- `sensitivity`: 0.5

**ç†ç”±**: 40-60%ã®Whisper APIã‚³ã‚¹ãƒˆå‰Šæ¸›ã‚’å®Ÿç¾ã€‚å¤‰æ›´ã™ã‚‹ã¨ã‚³ã‚¹ãƒˆãŒå¤§å¹…ã«å¢—åŠ ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

#### 4. ã‚·ãƒ¼ãƒ³æ¤œå‡ºã®é–¾å€¤
**ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡ºé–¾å€¤**: `[0.025, 0.055, 0.085]`ï¼ˆãƒžãƒ«ãƒãƒ‘ã‚¹æ–¹å¼ï¼‰
**ROIæ¤œå‡ºé–¾å€¤**: `[0.01, 0.015]`ï¼ˆã‚ˆã‚Šæ•æ„Ÿã«è¨­å®šã€ãƒ†ãƒ­ãƒƒãƒ—å¤‰åŒ–æ¤œå‡ºç”¨ï¼‰

**ç†ç”±**: åºƒç¯„å›²ã®ãƒ†ã‚¹ãƒˆã§æœ€é©åŒ–æ¸ˆã¿ã€‚å¤‰æ›´ã™ã‚‹ã¨èª¤æ¤œå‡ºãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**æ³¨**: 2025å¹´11æœˆ14æ—¥ã®ROIæ¤œå‡ºå®Ÿè£…ã«ã‚ˆã‚Šã€ã‚·ãƒ¼ãƒ³æ¤œå‡ºãŒ2æ®µéšŽã«åˆ†ã‹ã‚Œã¾ã—ãŸ:
- ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡º: ã‚«ãƒ¡ãƒ©ãƒ¯ãƒ¼ã‚¯ã€ã‚·ãƒ¼ãƒ³å¤‰åŒ–ã‚’æ¤œå‡º
- ROIæ¤œå‡ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰: ç”»é¢ä¸‹æ®µ15%é ˜åŸŸã®ãƒ†ãƒ­ãƒƒãƒ—ãƒ»å­—å¹•å¤‰åŒ–ã‚’æ¤œå‡º

#### 5. Vercel Blob APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆé‡è¦ï¼‰
**æ­£ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `https://blob.vercel-storage.com`

**é–“é•ã£ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆä½¿ç”¨ç¦æ­¢ï¼‰**:
- âŒ `https://blob.vercelusercontent.com` - **DNSã‚¨ãƒ©ãƒ¼ï¼ˆENOTFOUNDï¼‰ã®åŽŸå› **
- âŒ `https://vercel-storage.com` - èªè¨¼ã‚¨ãƒ©ãƒ¼ã®åŽŸå› 

**å½±éŸ¿ç¯„å›²**:
- `cloud-run-worker/src/services/blobUploader.ts` - Excelçµæžœãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãªã„ï¼‰

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**:
```typescript
// âœ… æ­£ã—ã„å®Ÿè£…
const blobApiUrl = 'https://blob.vercel-storage.com';

// Productionç’°å¢ƒã§ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãªã„
if (process.env.NODE_ENV === 'production') {
  throw new Error('Failed to upload to Vercel Blob');
}
```

**éŽåŽ»ã®å•é¡Œ**:
- **2025å¹´11æœˆ11æ—¥**: é–“é•ã£ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ`blob.vercelusercontent.com`ï¼‰ã«ã‚ˆã‚Šã€æœ¬ç•ªç’°å¢ƒã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡ŒãŒç™ºç”Ÿ
- **æ ¹æœ¬åŽŸå› **: DNSã‚¨ãƒ©ãƒ¼ï¼ˆENOTFOUNDï¼‰â†’ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ãŒæœ¬ç•ªç’°å¢ƒã§èª¤ã£ã¦ä½œå‹• â†’ data URIä¿å­˜ â†’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸å¯

**ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ**:
- [ ] ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ `blob.vercel-storage.com` ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] æœ¬ç•ªç’°å¢ƒã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### âš¡ ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

#### å•é¡Œ1: `CLOUD_RUN_URL`ã«æ”¹è¡Œæ–‡å­—ãŒæ··å…¥
**ç—‡çŠ¶**: `/api/process`ã§å‡¦ç†ãŒé–‹å§‹ã•ã‚Œãªã„

**å¯¾å‡¦**:
```bash
# Vercelç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª
vercel env pull .env.vercel
cat .env.vercel | grep CLOUD_RUN_URL

# æ”¹è¡Œé™¤åŽ»ã—ã¦å†è¨­å®š
vercel env rm CLOUD_RUN_URL production
vercel env add CLOUD_RUN_URL production
# â†’ æ”¹è¡Œãªã—ã®URLã‚’å…¥åŠ›
```

#### å•é¡Œ2: `GEMINI_API_KEY`æœªè¨­å®š
**ç—‡çŠ¶**: OCRãƒ†ã‚­ã‚¹ãƒˆãŒå…¨ã¦ç©ºæ–‡å­—åˆ—

**å¯¾å‡¦**:
```bash
# Cloud Runç’°å¢ƒå¤‰æ•°ç¢ºèª
gcloud run services describe video-analyzer-worker \
  --region us-central1 \
  --format="value(spec.template.spec.containers[0].env)" | grep GEMINI

# æœªè¨­å®šã®å ´åˆã¯è¿½åŠ 
gcloud run services update video-analyzer-worker \
  --region us-central1 \
  --update-env-vars "GEMINI_API_KEY=${GEMINI_API_KEY}"
```

#### å•é¡Œ3: Vercel Blobå®¹é‡ã‚ªãƒ¼ãƒãƒ¼
**ç—‡çŠ¶**: `Storage quota exceeded for Hobby plan (1GB maximum)`

**å¯¾å‡¦**:
```bash
# æ‰‹å‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆç·Šæ€¥æ™‚ï¼‰
npx dotenv -e .env.local tsx scripts/cleanup-blob-storage.ts delete-all

# è‡ªå‹•å‰Šé™¤æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª
# â†’ videoProcessor.ts (ã‚½ãƒ¼ã‚¹å‹•ç”») ã¨ download API (Excel) ã®ãƒ­ã‚°ç¢ºèª
```

#### å•é¡Œ4: å‡¦ç†ãŒå®Œäº†ã—ãªã„
**ç—‡çŠ¶**: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ`processing`ã®ã¾ã¾ã€ç‰¹å®šã®é€²æ—ã§åœæ­¢

**åŽŸå› **:
- Cloud Runã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ600ç§’è¶…éŽï¼‰
- Whisper APIãƒ¬ãƒ¼ãƒˆåˆ¶é™
- Gemini APIãƒ¬ãƒ¼ãƒˆåˆ¶é™

**å¯¾å‡¦**:
```bash
# ãƒ­ã‚°ç¢ºèªï¼ˆã‚¨ãƒ©ãƒ¼ç®‡æ‰€ç‰¹å®šï¼‰
gcloud run services logs read video-analyzer-worker \
  --region us-central1 \
  --filter "textPayload:upload_1730678901234_abc123xyz" \
  --limit 200

# Supabaseã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
# â†’ Supabase Dashboard â†’ Table Editor â†’ processing_status
```

#### å•é¡Œ5: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ60ç§’ï¼‰
**ä¿®æ­£æ—¥**: 2025å¹´11æœˆ6æ—¥
**ç—‡çŠ¶**: å¤§å®¹é‡å‹•ç”»ï¼ˆ400MBè¶…ï¼‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—

**ä¿®æ­£å†…å®¹**:
```typescript
// cloud-run-worker/src/services/videoProcessor.ts
timeout: 300000, // 5åˆ†ï¼ˆä»¥å‰: 60ç§’ï¼‰
maxContentLength: 500 * 1024 * 1024, // 500MB
maxBodyLength: 500 * 1024 * 1024
```

**ç¾åœ¨ã¯ä¿®æ­£æ¸ˆã¿**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒ5åˆ†ï¼ˆ300ç§’ï¼‰ã«å»¶é•·ã•ã‚Œã¦ã„ã‚‹ã€‚

---

## ðŸŽ¯ ROIï¼ˆRegion of Interestï¼‰æ¤œå‡º

### æ¦‚è¦
ROIæ¤œå‡ºã¯ã€å‹•ç”»ã®ç‰¹å®šé ˜åŸŸï¼ˆç”»é¢ä¸‹æ®µãªã©ï¼‰ã«ç‰¹åŒ–ã—ãŸã‚·ãƒ¼ãƒ³æ¤œå‡ºæ©Ÿèƒ½ã§ã™ã€‚ãƒ†ãƒ­ãƒƒãƒ—ã‚„å­—å¹•ã®å¤‰åŒ–ã‚’é«˜ç²¾åº¦ã«æ¤œå‡ºã™ã‚‹ã“ã¨ã§ã€å¾“æ¥ã®ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡ºã§ã¯è¦‹é€ƒã—ã¦ã„ãŸå¤‰åŒ–ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¾ã™ã€‚

### æœ‰åŠ¹åŒ–æ–¹æ³•

#### Cloud Runç’°å¢ƒå¤‰æ•°ã«è¿½åŠ 
```bash
# ç’°å¢ƒå¤‰æ•°è¨­å®š
export ROI_DETECTION_ENABLED=true

# Cloud Runã«ãƒ‡ãƒ—ãƒ­ã‚¤
gcloud run services update video-analyzer-worker \
  --region us-central1 \
  --update-env-vars "ROI_DETECTION_ENABLED=true"
```

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: `false`ï¼ˆç„¡åŠ¹ï¼‰ - æ—¢å­˜ã®å‹•ä½œã«å½±éŸ¿ãªã—

### å‹•ä½œãƒ¢ãƒ¼ãƒ‰

#### ROIç„¡åŠ¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡ºã®ã¿å®Ÿè¡Œ
- å¾“æ¥é€šã‚Šã®å‹•ä½œï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
- `SceneCut.source`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã—

#### ROIæœ‰åŠ¹
- ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡º + ROIæ¤œå‡ºã‚’ä¸¦è¡Œå®Ÿè¡Œ
- æ¤œå‡ºçµæžœã‚’ãƒžãƒ¼ã‚¸ï¼ˆé‡è¤‡å‰Šé™¤: 100msä»¥å†…ï¼‰
- `SceneCut.source`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§æ¤œå‡ºå…ƒã‚’è¿½è·¡

### æ¤œå‡ºã‚½ãƒ¼ã‚¹åˆ†é¡ž

| ã‚½ãƒ¼ã‚¹ | æ„å‘³ | æ¤œå‡ºç†ç”± |
|--------|------|----------|
| `full_frame` | ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡ºã®ã¿ | ã‚·ãƒ¼ãƒ³å¤‰åŒ–ã€ã‚«ãƒ¡ãƒ©ãƒ¯ãƒ¼ã‚¯ |
| `roi_bottom` | ROIæ¤œå‡ºã®ã¿ï¼ˆä¸‹æ®µ15%ï¼‰ | ãƒ†ãƒ­ãƒƒãƒ—ãƒ»å­—å¹•å¤‰åŒ– |
| `both` | ä¸¡æ–¹ã§æ¤œå‡º | ã‚·ãƒ¼ãƒ³å¤‰åŒ– + ãƒ†ãƒ­ãƒƒãƒ—å¤‰åŒ– |

### Phase 2å®Ÿè£…ï¼ˆ4é ˜åŸŸå¯¾å¿œï¼‰- 2025å¹´11æœˆ14æ—¥å®Œäº†

**å¯¾å¿œé ˜åŸŸ**: 4é ˜åŸŸã™ã¹ã¦
1. **ä¸‹æ®µ15%**: `iw:ih*0.15:0:ih*0.85` - å­—å¹•ãƒ»ãƒ†ãƒ­ãƒƒãƒ—ï¼ˆé–¾å€¤: `[0.01, 0.015]`ï¼‰
2. **ä¸­å¤®15%**: `iw:ih*0.15:0:ih*0.425` - ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆé–¾å€¤: `[0.01, 0.015]`ï¼‰
3. **å·¦ä¸Š10%**: `iw*0.25:ih*0.1:0:0` - ãƒ­ã‚´ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆé–¾å€¤: `[0.015, 0.02]`ï¼‰
4. **å³ä¸Š10%**: `iw*0.25:ih*0.1:iw*0.75:0` - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆé–¾å€¤: `[0.015, 0.02]`ï¼‰

**ã‚«ãƒãƒ¬ãƒƒã‚¸**: 95%+ã®å‹•ç”»ï¼ˆã»ã¼ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’æ¤œå‡ºï¼‰

**æƒ³å®šç”¨é€”**:
- ãƒ†ãƒ¬ãƒ“ç•ªçµ„ã®ãƒ†ãƒ­ãƒƒãƒ—ï¼ˆä¸‹æ®µï¼‰
- YouTubeã®å­—å¹•ï¼ˆä¸‹æ®µï¼‰
- ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‹•ç”»ã®ã‚¹ãƒ©ã‚¤ãƒ‰ï¼ˆä¸­å¤®ï¼‰
- ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆä¸‹æ®µãƒ»å·¦ä¸Šãƒ»å³ä¸Šï¼‰
- ãƒ­ã‚´ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆå·¦ä¸Šï¼‰
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå³ä¸Šï¼‰

### ãƒ­ã‚°å‡ºåŠ›ä¾‹

```
ðŸ“Š ROI Detection Results Summary:
   Total scene cuts: 47
   ðŸŽ¬ Full-frame detection: 12 (camera work, scene changes)
   ðŸŽ¯ ROI detection: 28 (subtitle/text changes)
   ðŸ”— Both detected: 7 (scene change + text change)

   First 10 scene cuts:
   ðŸŽ¬  1) 2.5s (scene_change)
   ðŸŽ¯  2) 5.8s (subtitle_change)
   ðŸŽ¯  3) 8.2s (subtitle_change)
   ðŸ”—  4) 15.0s (both)
   ðŸŽ¬  5) 18.3s (scene_change)
   ðŸŽ¯  6) 22.1s (subtitle_change)
   ðŸŽ¯  7) 25.7s (subtitle_change)
   ðŸŽ¬  8) 30.5s (scene_change)
   ðŸŽ¯  9) 33.9s (subtitle_change)
   ðŸŽ¯ 10) 37.2s (subtitle_change)
   ... and 37 more cuts
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### å•é¡Œ: ROIæ¤œå‡ºãŒæœ‰åŠ¹ã«ãªã‚‰ãªã„
**ç¢ºèªäº‹é …**:
```bash
# ç’°å¢ƒå¤‰æ•°ç¢ºèª
gcloud run services describe video-analyzer-worker \
  --region us-central1 \
  --format="value(spec.template.spec.containers[0].env)" | grep ROI

# æ­£ã—ã„å€¤: ROI_DETECTION_ENABLED=true
```

**å¯¾å‡¦**:
```bash
# ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ /æ›´æ–°
gcloud run services update video-analyzer-worker \
  --region us-central1 \
  --update-env-vars "ROI_DETECTION_ENABLED=true"
```

#### å•é¡Œ: ãƒ­ã‚°ã«æ¤œå‡ºçµæžœã‚µãƒžãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„
**åŽŸå› **: ROIæ¤œå‡ºãŒç„¡åŠ¹ã€ã¾ãŸã¯ã‚·ãƒ¼ãƒ³æ¤œå‡ºè‡ªä½“ãŒå¤±æ•—

**ç¢ºèª**:
```bash
# ãƒ­ã‚°ç¢ºèª
gcloud run services logs read video-analyzer-worker \
  --region us-central1 \
  --filter "textPayload:ROI Detection Results" \
  --limit 10
```

### ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

#### Phase 2: 4é ˜åŸŸå¯¾å¿œ
- ä¸‹æ®µ15%ï¼ˆå­—å¹•ï¼‰
- ä¸­å¤®15%ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
- å·¦ä¸Š10%ï¼ˆãƒ­ã‚´ï¼‰
- å³ä¸Š10%ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰

#### Phase 3: ã‚«ã‚¹ã‚¿ãƒ é ˜åŸŸè¨­å®š
- JSONè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®é ˜åŸŸå®šç¾©
- è¤‡æ•°ã‚¯ãƒ­ãƒƒãƒ—ãƒ•ã‚£ãƒ«ã‚¿ã®çµ„ã¿åˆã‚ã›
- å‹•çš„é–¾å€¤èª¿æ•´

#### Phase 4: æ©Ÿæ¢°å­¦ç¿’çµ±åˆ
- ãƒ†ã‚­ã‚¹ãƒˆé ˜åŸŸã®è‡ªå‹•æ¤œå‡º
- OCRçµæžœã¨ã®é€£æº
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®é–¾å€¤æœ€é©åŒ–

### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

**åž‹å®šç¾©**:
- `cloud-run-worker/src/types/excel.ts:excel.ts:69-124`

**ã‚³ã‚¢å®Ÿè£…**:
- `cloud-run-worker/src/services/ffmpeg.ts`ï¼ˆ7ã¤ã®æ–°é–¢æ•°ï¼‰

**ãƒ†ã‚¹ãƒˆ**:
- `/tmp/integration-test.mjs`ï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆï¼‰
- `/tmp/ffmpeg-crop-test.sh`ï¼ˆFFmpegã‚¯ãƒ­ãƒƒãƒ—æ¤œè¨¼ï¼‰
- `/tmp/test-crop-validation.mjs`ï¼ˆæ§‹æ–‡æ¤œè¨¼ï¼‰

---

## ðŸ“ ç’°å¢ƒå¤‰æ•°ä¸€è¦§

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVercelï¼‰
| å¤‰æ•°å | å¿…é ˆ | èª¬æ˜Ž |
|-------|------|------|
| `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` | âœ… | Clerkå…¬é–‹éµ |
| `CLERK_SECRET_KEY` | âœ… | Clerkã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ |
| `BLOB_READ_WRITE_TOKEN` | âœ… | Vercel Blobãƒˆãƒ¼ã‚¯ãƒ³ |
| `CLOUD_RUN_URL` | âœ… | Cloud Run Worker URLï¼ˆ**æ”¹è¡Œãªã—ç¢ºèª**ï¼‰ |
| `WORKER_SECRET` | âœ… | Workerèªè¨¼ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ |
| `NEXT_PUBLIC_SUPABASE_URL` | âœ… | Supabase URL |
| `SUPABASE_SERVICE_ROLE_KEY` | âœ… | Supabaseã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚­ãƒ¼ |
| `NODE_ENV` | âœ… | ç’°å¢ƒãƒ¢ãƒ¼ãƒ‰ï¼ˆ`production` / `development`ï¼‰ |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆCloud Runï¼‰
| å¤‰æ•°å | å¿…é ˆ | èª¬æ˜Ž |
|-------|------|------|
| `BLOB_READ_WRITE_TOKEN` | âœ… | Vercel Blobãƒˆãƒ¼ã‚¯ãƒ³ |
| `SUPABASE_URL` | âœ… | Supabase URL |
| `SUPABASE_SERVICE_ROLE_KEY` | âœ… | Supabaseã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚­ãƒ¼ |
| `OPENAI_API_KEY` | âœ… | OpenAI APIã‚­ãƒ¼ï¼ˆWhisperç”¨ã€OCRãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ |
| `GEMINI_API_KEY` | âœ… | Gemini APIã‚­ãƒ¼ï¼ˆ**OCR ãƒ—ãƒ©ã‚¤ãƒžãƒª**ï¼‰ |
| `WORKER_SECRET` | âœ… | Workerèªè¨¼ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆVercelã¨åŒã˜å€¤ï¼‰ |
| `NODE_ENV` | âœ… | `production`ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰ |
| `ROI_DETECTION_ENABLED` | âŒ | ROIæ¤œå‡ºæœ‰åŠ¹åŒ–ï¼ˆ`true` / `false`ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `false`ï¼‰ |
| `PORT` | âŒ | ãƒãƒ¼ãƒˆç•ªå·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 8080ï¼‰ |

### ãƒžãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼OCRè¨­å®šï¼ˆ2026-02-08è¿½åŠ ï¼‰
| å¤‰æ•°å | å¿…é ˆ | èª¬æ˜Ž |
|-------|------|------|
| `GEMINI_MAX_PARALLEL` | âŒ | Geminiä¸¦åˆ—åº¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰ |
| `GEMINI_RATE_LIMIT` | âŒ | Geminiãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100 req/minï¼‰ |
| `GEMINI_MODEL` | âŒ | Geminiãƒ¢ãƒ‡ãƒ«åï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: gemini-2.5-flashï¼‰ |
| `MISTRAL_API_KEY` | âŒ | Mistral APIã‚­ãƒ¼ï¼ˆã‚»ã‚«ãƒ³ãƒ€ãƒªOCRï¼‰ |
| `MISTRAL_MAX_PARALLEL` | âŒ | Mistralä¸¦åˆ—åº¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰ |
| `MISTRAL_RATE_LIMIT` | âŒ | Mistralãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100 req/minï¼‰ |
| `MISTRAL_MODEL` | âŒ | Mistralãƒ¢ãƒ‡ãƒ«åï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: pixtral-12b-2409ï¼‰ |
| `GLM_API_KEY` | âŒ | GLM (ZhipuAI) APIã‚­ãƒ¼ï¼ˆã‚»ã‚«ãƒ³ãƒ€ãƒªOCRï¼‰ |
| `GLM_MAX_PARALLEL` | âŒ | GLMä¸¦åˆ—åº¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰ |
| `GLM_RATE_LIMIT` | âŒ | GLMãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100 req/minï¼‰ |
| `GLM_MODEL` | âŒ | GLMãƒ¢ãƒ‡ãƒ«åï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: glm-4vï¼‰ |
| `OPENAI_MAX_PARALLEL` | âŒ | OpenAI OCRä¸¦åˆ—åº¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰ |
| `OPENAI_RATE_LIMIT` | âŒ | OpenAI OCRãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100 req/minï¼‰ |
| `OPENAI_MODEL` | âŒ | OpenAI OCRãƒ¢ãƒ‡ãƒ«åï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: gpt-4o-miniï¼‰ |

**OCRãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å„ªå…ˆé †ä½**: Gemini (1) > Mistral (2) > GLM (3) > OpenAI (4)
**1æ™‚é–“ä»¥ä¸Šã®å‹•ç”»**: è‡ªå‹•çš„ã«ä¸¦åˆ—åº¦ãŒ2å€ã«ãƒ–ãƒ¼ã‚¹ãƒˆã•ã‚Œã¾ã™

---

## ðŸ”„ æœ€è¿‘ã®ä¸»è¦ãªå¤‰æ›´

### 2026å¹´2æœˆ8æ—¥: ãƒžãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼OCRé«˜é€ŸåŒ–
**ç›®çš„**: OCRå‡¦ç†ã®é«˜é€ŸåŒ–ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½è¿½åŠ 

**å®Ÿè£…å†…å®¹**:
- ãƒžãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼OCRãƒ«ãƒ¼ã‚¿ãƒ¼å®Ÿè£…
- å¯¾å¿œãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼: Gemini (primary), Mistral, GLM, OpenAI (fallback)
- è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼éšœå®³æ™‚ï¼‰
- 1æ™‚é–“ä»¥ä¸Šã®å‹•ç”»ã§è‡ªå‹•ä¸¦åˆ—ãƒ–ãƒ¼ã‚¹ãƒˆï¼ˆ2å€ï¼‰
- load-balancedåˆ†æ•£æˆ¦ç•¥

**æœŸå¾…ã•ã‚Œã‚‹åŠ¹æžœ**:
| å‡¦ç† | æ”¹å–„å‰ | æ”¹å–„å¾Œ |
|-----|--------|-------|
| 100ã‚·ãƒ¼ãƒ³OCR | ~3åˆ†30ç§’ | ~30ç§’-1åˆ† |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™è€æ€§ | å˜ä¸€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä¾å­˜ | è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
| 1æ™‚é–“å‹•ç”» | æ¨™æº–ä¸¦åˆ—åº¦ | 2å€ä¸¦åˆ—ãƒ–ãƒ¼ã‚¹ãƒˆ |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `cloud-run-worker/src/services/ocrRouter.ts`: OCRãƒ«ãƒ¼ã‚¿ãƒ¼ï¼ˆæ–°è¦ï¼‰
- `cloud-run-worker/src/services/ocrProviderInterface.ts`: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæ–°è¦ï¼‰
- `cloud-run-worker/src/services/providers/`: å„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…
- `cloud-run-worker/src/services/pipeline.ts`: OCRãƒ«ãƒ¼ã‚¿ãƒ¼çµ±åˆ

---

### 2026å¹´2æœˆ5æ—¥: Cloud Run ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å¤§å¹…æ”¹å–„
**ç›®çš„**: å‡¦ç†é€Ÿåº¦ã®å¤§å¹…ãªå‘ä¸Šï¼ˆ10-50å€ã®é«˜é€ŸåŒ–ï¼‰

**å•é¡Œ**:
- 20MB/15ç§’ã®å‹•ç”»å‡¦ç†ã«ç´„18åˆ†ã‹ã‹ã£ã¦ã„ãŸï¼ˆæœŸå¾…å€¤: 1-3åˆ†ï¼‰
- R2ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: 201ç§’ï¼ˆ0.10 MB/sï¼‰
- FFmpegæ“ä½œãŒæ¥µç«¯ã«é…ã„
- éŸ³å£°ãƒãƒ£ãƒ³ã‚¯æŠ½å‡ºãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**æ ¹æœ¬åŽŸå› **:
1. **CPUä¸è¶³**: 1 vCPUã§ã¯FFmpegã«ä¸ååˆ†
2. **CPUã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“ã§CPUãŒæŠ‘åˆ¶
3. **gVisorç’°å¢ƒ**: gen1ç’°å¢ƒã§ã¯FFmpegãŒãƒãƒ³ã‚°ã—ã‚„ã™ã„
4. **fluent-ffmpeg**: `.run()`ãƒ¡ã‚½ãƒƒãƒ‰ãŒgVisorã§å•é¡Œã‚’èµ·ã“ã™

**è§£æ±ºç­–**:

#### 1. Cloud Run ãƒªã‚½ãƒ¼ã‚¹è¨­å®šæ›´æ–°
```bash
gcloud run services update video-analyzer-worker \
  --region us-central1 \
  --cpu 4 \
  --memory 4Gi \
  --concurrency 1 \
  --no-cpu-throttling \
  --execution-environment gen2
```

| è¨­å®š | å¤‰æ›´å‰ | å¤‰æ›´å¾Œ |
|-----|-------|-------|
| CPU | 1 vCPU | 4 vCPU |
| ãƒ¡ãƒ¢ãƒª | 2 GB | 4 GB |
| åŒæ™‚å®Ÿè¡Œæ•° | 160 | 1 |
| CPUã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚° | æœ‰åŠ¹ | **ç„¡åŠ¹** |
| å®Ÿè¡Œç’°å¢ƒ | gen1 (gVisor) | **gen2** (Linux VM) |

#### 2. audioExtractor.ts ã‚’ spawn ãƒ™ãƒ¼ã‚¹ã«æ›¸ãæ›ãˆ
`fluent-ffmpeg`ã®`.run()`ãƒ¡ã‚½ãƒƒãƒ‰ã¯gVisorç’°å¢ƒã§ãƒãƒ³ã‚°ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€
`spawn`ã‚’ç›´æŽ¥ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã€‚

**æ›¸ãæ›ãˆãŸé–¢æ•°**:
- `extractAudioForWhisper()` - éŸ³å£°æŠ½å‡º
- `preprocessAudioForVAD()` - VADå‰å‡¦ç†
- `extractAudioChunk()` - ãƒãƒ£ãƒ³ã‚¯æŠ½å‡º
- `splitAudioIntoChunks()` - äº‹å‰åˆ†å‰²
- `getAudioMetadata()` - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```typescript
// gVisoräº’æ›ç’°å¢ƒå¤‰æ•°
function getGVisorEnv(): NodeJS.ProcessEnv {
  return {
    ...process.env,
    FONTCONFIG_PATH: '',
    FONTCONFIG_FILE: '/dev/null',
    FC_DEBUG: '0',
    HOME: '/tmp',
    XDG_CACHE_HOME: '/tmp',
    XDG_CONFIG_HOME: '/tmp',
    FFREPORT: '',
    AV_LOG_FORCE_NOCOLOR: '1',
  };
}

// spawn + ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¦ã‚©ãƒƒãƒãƒ‰ãƒƒã‚°
const proc = spawn('ffmpeg', args, {
  env: getGVisorEnv(),
  stdio: ['ignore', 'pipe', 'pipe'],
});

// 60ç§’é–“å‡ºåŠ›ãŒãªã‘ã‚Œã°ãƒ—ãƒ­ã‚»ã‚¹ã‚’kill
const activityInterval = setInterval(() => {
  if (Date.now() - lastActivityTime > 60000) {
    proc.kill('SIGKILL');
  }
}, 10000);
```

**æœŸå¾…ã•ã‚Œã‚‹åŠ¹æžœ**:
| å‡¦ç† | æ”¹å–„å‰ | æ”¹å–„å¾Œï¼ˆäºˆæƒ³ï¼‰ |
|-----|--------|--------------|
| R2ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (20MB) | 201ç§’ | 5-20ç§’ |
| ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º | 59ç§’ | 1-5ç§’ |
| éŸ³å£°æŠ½å‡º | 277ç§’ | 10-30ç§’ |
| **åˆè¨ˆ** | ~18åˆ† | **1-3åˆ†** |

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `cloud-run-worker/src/services/audioExtractor.ts`: spawn ãƒ™ãƒ¼ã‚¹ã«æ›¸ãæ›ãˆ
- Cloud Run ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š

---

### 2025å¹´11æœˆ14æ—¥: ROIï¼ˆRegion of Interestï¼‰æ¤œå‡ºå®Ÿè£…
**ç›®çš„**: ãƒ†ãƒ­ãƒƒãƒ—ãƒ»å­—å¹•å¤‰åŒ–ã®é«˜ç²¾åº¦æ¤œå‡º

**å•é¡Œ**:
- å¾“æ¥ã®ã‚·ãƒ¼ãƒ³æ¤œå‡ºã¯å…¨ç”»é¢ã‚’å¯¾è±¡ã¨ã—ã¦ãŠã‚Šã€ãƒ†ãƒ­ãƒƒãƒ—å¤‰åŒ–ã‚’è¦‹é€ƒã™å ´åˆãŒã‚ã£ãŸ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€Œãƒ†ãƒ­ãƒƒãƒ—ãŒ3å›žå‡ºç¾ã™ã‚‹ãŒ1å›žã—ã‹æ¤œå‡ºã•ã‚Œãªã„ã€ã¨ã„ã†å ±å‘Š

**è§£æ±ºç­–**:
- ROIæ¤œå‡ºæ©Ÿèƒ½ã‚’å®Ÿè£…ï¼ˆMVP: ç”»é¢ä¸‹æ®µ15%é ˜åŸŸï¼‰
- ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ æ¤œå‡ºã¨ROIæ¤œå‡ºã‚’ä¸¦è¡Œå®Ÿè¡Œã—ã€çµæžœã‚’ãƒžãƒ¼ã‚¸
- æ¤œå‡ºã‚½ãƒ¼ã‚¹ã‚’ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆ`full_frame`, `roi_bottom`, `both`ï¼‰

**å®Ÿè£…å†…å®¹**:
- æ–°ã—ã„åž‹å®šç¾©: `ROIRegion`, `ROIConfig`
- `SceneCut`åž‹ã«`source`ã¨`detectionReason`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- 7ã¤ã®æ–°é–¢æ•°å®Ÿè£…:
  - `loadROIConfigFromEnv()`: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ROIè¨­å®šã‚’èª­ã¿è¾¼ã¿
  - `validateCropFilter()`: FFmpegã‚¯ãƒ­ãƒƒãƒ—æ§‹æ–‡ã®æ¤œè¨¼
  - `mergeCutsWithSource()`: æ¤œå‡ºçµæžœã®ãƒžãƒ¼ã‚¸ã¨ã‚½ãƒ¼ã‚¹è¿½è·¡
  - `deduplicateCuts()`: 100msä»¥å†…ã®é‡è¤‡å‰Šé™¤
  - `detectROICuts()`: ROIé ˜åŸŸã®ã‚·ãƒ¼ãƒ³æ¤œå‡º
  - `runSceneDetectionWithCrop()`: ã‚¯ãƒ­ãƒƒãƒ—ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ç‰ˆFFmpegå®Ÿè¡Œ
  - `logROIDetectionResults()`: æ¤œå‡ºçµæžœã®è©³ç´°ãƒ­ã‚°å‡ºåŠ›

**è¨­å®šæ–¹æ³•**:
```bash
# Cloud Runç’°å¢ƒå¤‰æ•°ã«è¿½åŠ 
export ROI_DETECTION_ENABLED=true

# ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚
gcloud run services update video-analyzer-worker \
  --region us-central1 \
  --update-env-vars "ROI_DETECTION_ENABLED=true"
```

**å¾Œæ–¹äº’æ›æ€§**:
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯`false`ï¼ˆç„¡åŠ¹ï¼‰
- æœ‰åŠ¹åŒ–ã—ãªã„é™ã‚Šæ—¢å­˜ã®å‹•ä½œã«å½±éŸ¿ãªã—

**ä»Šå¾Œã®æ‹¡å¼µäºˆå®š**:
- Phase 2: 4é ˜åŸŸå¯¾å¿œï¼ˆä¸‹æ®µã€ä¸­å¤®ã€å·¦ä¸Šã€å³ä¸Šï¼‰
- Phase 3: ã‚«ã‚¹ã‚¿ãƒ é ˜åŸŸè¨­å®š

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `cloud-run-worker/src/types/excel.ts`: åž‹å®šç¾©è¿½åŠ 
- `cloud-run-worker/src/services/ffmpeg.ts`: ã‚³ã‚¢å®Ÿè£…
- `CLAUDE.md`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### 2025å¹´11æœˆ6æ—¥: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é€²æ—ãƒ­ã‚°ä¿®æ­£
**å•é¡Œ**: é€²æ—ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œãªã„ï¼ˆ10MBã®å€æ•°ãƒã‚§ãƒƒã‚¯ãŒã»ã¼ç™ºç«ã—ãªã„ï¼‰

**ä¿®æ­£å†…å®¹**:
```typescript
// ä»¥å‰: 10MBã®å€æ•°ã¡ã‚‡ã†ã©ã®æ™‚ã ã‘ãƒ­ã‚°
if (totalBytes > 0 && downloadedBytes % (10 * 1024 * 1024) === 0) {
  console.log(`Progress: ...`);
}

// ç¾åœ¨: æœ€å¾Œã®ãƒ­ã‚°ã‹ã‚‰10MBä»¥ä¸Šãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ãƒ­ã‚°
let lastLoggedBytes = 0;
if (totalBytes > 0 && downloadedBytes - lastLoggedBytes >= LOG_INTERVAL) {
  console.log(`Progress: ${percent}% (${downloadedMB}MB / ${totalMB}MB)`);
  lastLoggedBytes = downloadedBytes;
}
```

**å½±éŸ¿**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é€²æ—ã®å¯è¦–åŒ–ã€ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§å‘ä¸Š

### 2025å¹´11æœˆ6æ—¥: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå»¶é•·
**å•é¡Œ**: å¤§å®¹é‡å‹•ç”»ï¼ˆ445MBï¼‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒ60ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**ä¿®æ­£å†…å®¹**: 60ç§’ â†’ 300ç§’ï¼ˆ5åˆ†ï¼‰ã«å»¶é•·

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**: `cloud-run-worker/src/services/videoProcessor.ts:videoProcessor.ts:167-169`

### 2025å¹´11æœˆ4æ—¥: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£ï¼ˆIDORè„†å¼±æ€§ï¼‰
**å•é¡Œ**: ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒé–²è¦§å¯èƒ½

**ä¿®æ­£å†…å®¹**:
- `processing_status`ãƒ†ãƒ¼ãƒ–ãƒ«ã«`user_id`ã‚«ãƒ©ãƒ è¿½åŠ 
- RLSï¼ˆRow Level Securityï¼‰ãƒãƒªã‚·ãƒ¼æœ‰åŠ¹åŒ–

**ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: `supabase-migrations/002_add_user_id_and_fix_rls.sql`

### 2025å¹´11æœˆ3æ—¥: æ°¸ç¶šã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ•ã‚£ãƒ«ã‚¿æ”¹å–„
**å•é¡Œ**: å°‘æ•°ã‚·ãƒ¼ãƒ³ã§ã®çµ±è¨ˆçš„ä¸å®‰å®šæ€§

**ä¿®æ­£å†…å®¹**:
- æœ€å°ã‚·ãƒ¼ãƒ³æ•°ãƒã‚§ãƒƒã‚¯è¿½åŠ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3ï¼‰
- è¨­å®šå¯èƒ½ãªé–¾å€¤ï¼ˆ`threshold`, `minScenes`ï¼‰

### 2025å¹´11æœˆ3æ—¥: `/api/process`ã®awaitè¿½åŠ 
**å•é¡Œ**: å‡¦ç†é–‹å§‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œãªã„ï¼ˆéžåŒæœŸã‚¨ãƒ©ãƒ¼ï¼‰

**ä¿®æ­£å†…å®¹**: `fetch()`ã«`await`è¿½åŠ 

### 2025å¹´11æœˆ2æ—¥: ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°å®Ÿè£…
**è¿½åŠ å†…å®¹**:
- 6ã¤ã®ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒªã‚·ãƒ¼ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ¼ãƒˆã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã€ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŽ‡ãªã©ï¼‰
- 3ã¤ã®ãƒ­ã‚°ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- Cloud Monitoringãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- è‡ªå‹•ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `monitoring/`

### 2025å¹´11æœˆ1æ—¥: Blobè‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè£…
**ç›®çš„**: Vercel Blobå®¹é‡åˆ¶é™ï¼ˆHobby: 1GBï¼‰å¯¾ç­–

**å®Ÿè£…ç®‡æ‰€**:
1. ã‚½ãƒ¼ã‚¹å‹•ç”»å‰Šé™¤ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†ç›´å¾Œï¼‰
2. Excelçµæžœå‰Šé™¤ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç›´å¾Œï¼‰
3. Cronã‚¸ãƒ§ãƒ–ï¼ˆæ¯Žæ—¥3:00 AMã€7æ—¥ä»¥ä¸ŠçµŒéŽã—ãŸBlobã‚’å‰Šé™¤ï¼‰

### 2025å¹´10æœˆ30æ—¥: Excelå½¢å¼å¤§å¹…æ”¹å–„ï¼ˆV2.1ï¼‰
**ä»¥å‰ï¼ˆV2.0ï¼‰**:
- 4ã‚·ãƒ¼ãƒˆæ§‹æˆ: "Summary", "Transcription", "OCR Results", "Full Analysis"
- å›ºå®šé–“éš”ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º

**ç¾åœ¨ï¼ˆV2.1ï¼‰**:
- 2ã‚·ãƒ¼ãƒˆæ§‹æˆ: "Video Analysis"ï¼ˆ5åˆ—ï¼‰, "Statistics"
- ã‚·ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- ä¸­é–“ç‚¹ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæŠ½å‡º
- ç”»åƒåŸ‹ã‚è¾¼ã¿ï¼ˆã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ä¿æŒï¼‰

---

## ðŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVercelï¼‰
```bash
# è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ï¼‰
git add .
git commit -m "feat: Add new feature"
git push origin main

# æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤
vercel --prod
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆCloud Runï¼‰
```bash
cd cloud-run-worker

# ãƒ“ãƒ«ãƒ‰ç¢ºèª
./node_modules/.bin/tsc

# ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ2026å¹´2æœˆ5æ—¥æ›´æ–°: é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è¨­å®šï¼‰
gcloud run deploy video-analyzer-worker \
  --source . \
  --region us-central1 \
  --platform managed \
  --allow-unauthenticated \
  --memory 4Gi \
  --cpu 4 \
  --timeout 600 \
  --max-instances 10 \
  --concurrency 1 \
  --no-cpu-throttling \
  --execution-environment gen2
```

**é‡è¦ãªè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
- `--cpu 4`: FFmpegå‡¦ç†ã«å¿…è¦ãªååˆ†ãªCPU
- `--concurrency 1`: å‹•ç”»å‡¦ç†ã¯ãƒªã‚½ãƒ¼ã‚¹é›†ç´„åž‹ãªã®ã§1ãƒªã‚¯ã‚¨ã‚¹ãƒˆãšã¤
- `--no-cpu-throttling`: å¸¸æ™‚CPUã‚’å‰²ã‚Šå½“ã¦ï¼ˆã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ç„¡åŠ¹ï¼‰
- `--execution-environment gen2`: gVisorã§ã¯ãªãLinux VMï¼ˆFFmpegãƒãƒ³ã‚°å›žé¿ï¼‰

**ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª**:
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl https://video-analyzer-worker-820467345033.us-central1.run.app/health

# ãƒ­ã‚°ç¢ºèª
gcloud run services logs tail video-analyzer-worker --region us-central1
```

---

## ðŸ“š å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `README.md` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- `CLAUDE.md` - **Claudeé–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰**
- `SYSTEM_ARCHITECTURE_2025-11-04.md` - è©³ç´°ãªã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- `API_DOCUMENTATION.md` - APIä»•æ§˜
- `DEPLOYMENT_DESIGN.md` - ãƒ‡ãƒ—ãƒ­ã‚¤è¨­è¨ˆ
- `.claude/OCR_BEST_PRACTICES.md` - OCRãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- `docs/CLERK_EMAIL_AUTHENTICATION_GUIDE.md` - Clerkèªè¨¼ã‚¬ã‚¤ãƒ‰
- `docs/PROCESSING_STATUS_DISPLAY_GUIDE.md` - å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚¬ã‚¤ãƒ‰
- `docs/archive/` - éŽåŽ»ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒ³ãƒ‰ã‚ªãƒ•ãƒ»èª¿æŸ»è³‡æ–™

### å¤–éƒ¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Next.js 14 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nextjs.org/docs)
- [Cloud Run ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/run/docs)
- [Vercel Blob ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vercel.com/docs/storage/vercel-blob)
- [Supabase ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://supabase.com/docs)
- [OpenAI Whisper API](https://platform.openai.com/docs/api-reference/audio)
- [Google Gemini Vision API](https://ai.google.dev/docs/gemini_api_overview)

---

## ðŸ› ï¸ é–‹ç™ºã‚³ãƒžãƒ³ãƒ‰

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
npm run dev  # http://localhost:3000

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆCloud Run Workerï¼‰
cd cloud-run-worker
npm run dev  # http://localhost:8080
```

### ãƒ“ãƒ«ãƒ‰
```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
npm run build

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
cd cloud-run-worker
npm run build
```

### ãƒ†ã‚¹ãƒˆ
```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
npm test

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e

# æœ¬ç•ªç’°å¢ƒE2Eãƒ†ã‚¹ãƒˆ
npx jest __tests__/api/production-e2e.test.ts
```

### ãƒ­ã‚°ç¢ºèª
```bash
# Cloud Runï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
gcloud run services logs tail video-analyzer-worker --region us-central1

# ã‚¨ãƒ©ãƒ¼ã®ã¿
gcloud run services logs read video-analyzer-worker \
  --region us-central1 \
  --filter "severity>=ERROR" \
  --limit 50

# ç‰¹å®šUpload IDã®ãƒ­ã‚°
gcloud run services logs read video-analyzer-worker \
  --region us-central1 \
  --filter "textPayload:upload_1730678901234_abc123xyz" \
  --limit 100
```

---

## ðŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### å®Ÿè£…æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–
- âœ… **Clerkèªè¨¼**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼
- âœ… **WORKER_SECRET**: APIé–“èªè¨¼
- âœ… **RLSï¼ˆRow Level Securityï¼‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- âœ… **IDORä¿®æ­£**: ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é–²è¦§ä¸å¯
- âœ… **CSRFä¿è­·**: Clerkçµ„ã¿è¾¼ã¿ä¿è­·
- âœ… **SSRFä¿è­·**: Blob URLæ¤œè¨¼ï¼ˆ`vercel-storage`å«ã‚€ã‹ç¢ºèªï¼‰

### ä»Šå¾Œã®æ”¹å–„äºˆå®š
- âœ… **Secret Managerç§»è¡Œ**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…å®Œäº†ï¼ˆ2025-11-07ï¼‰- `scripts/migrate-to-secret-manager.sh`
  - è©³ç´°: `DEPLOYMENT_DESIGN.md` ã®ã€ŒSecret Managerç§»è¡Œã‚¬ã‚¤ãƒ‰ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§
- â³ **APIã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: Clerk, Blob, Supabase, WORKER_SECRET
- â³ **Gitå±¥æ­´ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: æ©Ÿå¯†æƒ…å ±å‰Šé™¤

---

## ðŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–

### å®Ÿè£…æ¸ˆã¿æœ€é©åŒ–
- **Cloud Run gen2 + 4 vCPU** (2026-02-05): å‡¦ç†é€Ÿåº¦10-50å€å‘ä¸Š
- **spawn ãƒ™ãƒ¼ã‚¹ FFmpeg** (2026-02-05): gVisorãƒãƒ³ã‚°å•é¡Œå›žé¿
- **CPUã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ç„¡åŠ¹** (2026-02-05): å¸¸æ™‚ãƒ•ãƒ«ãƒ‘ãƒ¯ãƒ¼
- **VADä½¿ç”¨**: Whisper APIã‚³ã‚¹ãƒˆ40-60%å‰Šæ¸›
- **ãƒãƒ£ãƒ³ã‚¯å‡¦ç†**: 10ç§’å˜ä½ã§Whisperå‡¦ç†
- **ãƒžãƒ«ãƒãƒ‘ã‚¹æ¤œå‡º**: é«˜ç²¾åº¦ãªã‚·ãƒ¼ãƒ³æ¤œå‡º
- **React Query**: ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- **R2ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®é«˜é€Ÿãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

### FFmpegå®Ÿè£…ã®æ³¨æ„ç‚¹
**é‡è¦**: Cloud Runç’°å¢ƒã§ã¯`fluent-ffmpeg`ã®`.run()`ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒãƒ³ã‚°ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

âœ… **æŽ¨å¥¨**: `spawn`ã‚’ç›´æŽ¥ä½¿ç”¨
```typescript
import { spawn } from 'child_process';
const proc = spawn('ffmpeg', args, {
  env: getGVisorEnv(),
  stdio: ['ignore', 'pipe', 'pipe'],
});
```

âŒ **éžæŽ¨å¥¨**: `fluent-ffmpeg`ã®`.run()`
```typescript
ffmpeg(input).output(output).run(); // Cloud Runã§ãƒãƒ³ã‚°ã™ã‚‹å¯èƒ½æ€§
```

### ä»Šå¾Œã®æœ€é©åŒ–äºˆå®š
- **Cloud CDN**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥å®Ÿè£…
- **ç”»åƒæœ€é©åŒ–**: Next.js Imageæœ€é©åŒ–
- **ä¸¦åˆ—å‡¦ç†**: Whisperãƒãƒ£ãƒ³ã‚¯ä¸¦åˆ—åŒ–

---

## ðŸ’¡ é–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ã‚³ãƒŸãƒƒãƒˆè¦ç´„
```bash
# ã‚³ãƒ³ãƒ™ãƒ³ã‚·ãƒ§ãƒŠãƒ«ã‚³ãƒŸãƒƒãƒˆå½¢å¼
feat: Add new feature
fix: Fix bug
docs: Update documentation
test: Add tests
refactor: Refactor code
chore: Update dependencies
```

### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥
- `main`: æœ¬ç•ªç’°å¢ƒï¼ˆä¿è­·ãƒ–ãƒ©ãƒ³ãƒï¼‰
- `feature/*`: æ–°æ©Ÿèƒ½é–‹ç™º
- `fix/*`: ãƒã‚°ä¿®æ­£
- `docs/*`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
1. `main`ã‹ã‚‰æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
2. å¤‰æ›´ã‚’å®Ÿè£…
3. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
4. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ
5. ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œã«ãƒžãƒ¼ã‚¸

---

## ðŸ¤– APIè‡ªå‹•åŒ–ã®æ´»ç”¨

### åŸºæœ¬æ–¹é‡
**ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›**: å¯èƒ½ãªé™ã‚ŠAPIçµŒç”±ã§ã®è‡ªå‹•åŒ–ã‚’å„ªå…ˆã—ã€æ‰‹å‹•UIæ“ä½œã‚’æœ€å°åŒ–ã™ã‚‹ã€‚

### Cloudflare API
Cloudflareã®å„ç¨®ãƒªã‚½ãƒ¼ã‚¹ã¯å…¬å¼APIã§ç®¡ç†å¯èƒ½ã€‚æ‰‹å‹•UIæ“ä½œã®ä»£ã‚ã‚Šã«APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å†ç¾æ€§ã¨åŠ¹çŽ‡ã‚’å‘ä¸Šã§ãã‚‹ã€‚

#### ä¸»è¦ãªæ©Ÿèƒ½
- **DNSç®¡ç†**: CNAME/A/TXTãƒ¬ã‚³ãƒ¼ãƒ‰ã®è¿½åŠ ãƒ»å‰Šé™¤ãƒ»æ›´æ–°
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‘ãƒ¼ã‚¸ï¼ˆå…¨ä½“/å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- **SSL/TLSè¨­å®š**: è¨¼æ˜Žæ›¸ç®¡ç†ã€æš—å·åŒ–ãƒ¢ãƒ¼ãƒ‰è¨­å®š
- **æ¨©é™ç®¡ç†**: APIãƒˆãƒ¼ã‚¯ãƒ³ã®ä½œæˆãƒ»æ¨©é™è¿½åŠ ãƒ»å‰Šé™¤

#### å®Ÿç”¨ä¾‹ï¼ˆã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å®Ÿæ–½ï¼‰
```bash
# Clerk DNSæ¤œè¨¼ç”¨ã®CNAMEãƒ¬ã‚³ãƒ¼ãƒ‰è¿½åŠ 
curl -X POST "https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records" \
  -H "Authorization: Bearer ${CF_API_TOKEN}" \
  -H "Content-Type: application/json" \
  --data '{
    "type": "CNAME",
    "name": "clerk.video-analyzer-v2.com",
    "content": "accounts.clerk.services",
    "ttl": 120,
    "proxied": false
  }'

# DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã®TTLçŸ­ç¸®ï¼ˆæ¤œè¨¼ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼‰
curl -X PATCH "https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/dns_records/${RECORD_ID}" \
  -H "Authorization: Bearer ${CF_API_TOKEN}" \
  -H "Content-Type: application/json" \
  --data '{"ttl": 120}'

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‘ãƒ¼ã‚¸ï¼ˆDNSå¤‰æ›´åæ˜ ä¿ƒé€²ï¼‰
curl -X POST "https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/purge_cache" \
  -H "Authorization: Bearer ${CF_API_TOKEN}" \
  -H "Content-Type: application/json" \
  --data '{"purge_everything": true}'
```

#### APIãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
```bash
# æ–°ã—ã„APIãƒˆãƒ¼ã‚¯ãƒ³ã¸ã®æ¨©é™è¿½åŠ ï¼ˆæ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ã®ç·¨é›†ï¼‰
# â†’ Cloudflare Dashboard â†’ My Profile â†’ API Tokens â†’ Edit
# å¿…è¦ãªæ¨©é™: Zone.DNS (Edit), Zone.Cache Purge (Purge)
```

### Clerk API/Dashboard
Clerkã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã¯ä¸€éƒ¨APIå¯¾å¿œã—ã¦ã„ã‚‹ãŒã€DNSæ¤œè¨¼ãƒˆãƒªã‚¬ãƒ¼ãªã©ä¸€éƒ¨ã®æ“ä½œã¯DashboardçµŒç”±ãŒæŽ¨å¥¨ã•ã‚Œã‚‹ã€‚

#### ä¸»è¦ãªæ©Ÿèƒ½
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š**: DNSæ¤œè¨¼ã€SSLè¨¼æ˜Žæ›¸è‡ªå‹•ç™ºè¡Œ
- **ãƒ¡ãƒ¼ãƒ«è¨­å®š**: ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡è¨­å®š
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: APIçµŒç”±ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œï¼ˆCRUDï¼‰

#### æ³¨æ„ç‚¹
- **DNSæ¤œè¨¼ãƒˆãƒªã‚¬ãƒ¼**: Clerk Dashboardã§ã€ŒVerifyã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆAPIæœªå¯¾å¿œã®å¯èƒ½æ€§ï¼‰
- **SSLè¨¼æ˜Žæ›¸ç™ºè¡Œ**: DNSæ¤œè¨¼å®Œäº†å¾Œã€è‡ªå‹•çš„ã«ç™ºè¡Œã•ã‚Œã‚‹ï¼ˆé€šå¸¸24æ™‚é–“ä»¥å†…ï¼‰
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: DNSæ¤œè¨¼å¤±æ•—æ™‚ã¯ã€TTLã€ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã€ãƒ¬ã‚³ãƒ¼ãƒ‰å†…å®¹ã‚’ç¢ºèª

### é–‹ç™ºæ–¹é‡ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### APIå„ªå…ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
1. **èª¿æŸ»**: æ‰‹å‹•UIæ“ä½œãŒå¿…è¦ãªå ´åˆã€ã¾ãšAPIå¯¾å¿œã®å¯å¦ã‚’ç¢ºèª
2. **å®Ÿè£…**: APIå¯¾å¿œã—ã¦ã„ã‚‹å ´åˆã¯ã€å¿…ãšAPIçµŒç”±ã§å®Ÿè¡Œ
3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–**: APIã‚³ãƒžãƒ³ãƒ‰ã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã—ã€å†åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹
4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: APIæœªå¯¾å¿œã®å ´åˆã®ã¿ã€æ‰‹å‹•UIæ“ä½œã®æ‰‹é †ã‚’æ˜Žè¨˜

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …
- **æœ€å°æ¨©é™ã®åŽŸå‰‡**: APIãƒˆãƒ¼ã‚¯ãƒ³ã«ã¯å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ã‚’ä»˜ä¸Ž
- **ãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: å®šæœŸçš„ã«APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’å†ç”Ÿæˆï¼ˆæŽ¨å¥¨: 90æ—¥ã”ã¨ï¼‰
- **ä½œæ¥­å®Œäº†å¾Œã®ç„¡åŠ¹åŒ–**: ä¸€æ™‚çš„ãªæ¨©é™ãŒå¿…è¦ãªå ´åˆã€ä½œæ¥­å®Œäº†å¾Œã™ãã«å‰Šé™¤
- **ç’°å¢ƒå¤‰æ•°ç®¡ç†**: APIãƒˆãƒ¼ã‚¯ãƒ³ã¯`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼ˆ`.gitignore`ã§é™¤å¤–ï¼‰

#### å®Ÿè£…ä¾‹ï¼ˆæŽ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
```bash
# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
cat > .env.cloudflare <<EOF
CF_API_TOKEN=your_token_here
ZONE_ID=your_zone_id_here
EOF

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®åˆ©ç”¨
source .env.cloudflare
./scripts/update-dns.sh
```

### å‚è€ƒãƒªã‚½ãƒ¼ã‚¹
- [Cloudflare API Documentation](https://developers.cloudflare.com/api/)
- [Clerk API Documentation](https://clerk.com/docs/reference/backend-api)
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: `scripts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

---

## ðŸ“ž ã‚µãƒãƒ¼ãƒˆ

### å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ
1. æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã€Œã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
2. `SYSTEM_ARCHITECTURE_2025-11-04.md`ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
3. Cloud Runãƒ­ã‚°ã‚’ç¢ºèª
4. Supabase Dashboardã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª

### ãƒªã‚½ãƒ¼ã‚¹
- **æœ¬ç•ªURLï¼ˆæŽ¨å®šï¼‰**: https://video-analyzer-v2.vercel.app
- **Cloud Run URL**: https://video-analyzer-worker-820467345033.us-central1.run.app
- **Supabase URL**: https://gcwdkjyyhmqtrxvmvnvn.supabase.co

---

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.2.0
**æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ5æ—¥
**ä½œæˆè€…**: Claude Code (Anthropic)
